---
published: true
date: '2023-06-20 11:25 +0530'
title: cs-sr-l3vpn-ncs540
author: Ananya Bose
position: hidden
---
## Overview

Circuit-style segment routing provides deterministic behaviour for routed traffic, making it particularly suitable for use cases that require persistent co-routed bidirectional paths, guaranteed bandwidth, and end-to-end path protection. The use cases we will be addressing here pertain to Utility WAN substation automation, encompassing L3 services from substation to control centre (SCADA data, CCTV, enterprise, etc.) and L2 services from substation to substation (Ethernet Teleprotection, L2 Utility protocols, e.g. GOOSE with stringent latency constraints) with CS-SR as part of the wider tutorial series. To flag off the series, let us start with CS-SR policy provisioning for L3VPN SCADA service.

## Topology & Use Case

We are using a mix of routers across the NCS540 portfolio as the PEs and WAN core routers. To illustrate the L3VPN with CS-SR use case in this tutorial, we are showcasing a subset of the broader topology as depicted the figure below. 

![topo_2.png]({{site.baseurl}}/images/topo_2.png)


| Nodes | Device Type | Software Version  |
|-------|-------------|-------------------|
| PE1   |  NCS 540    | IOS XR 7.9.1      |
| P2    |  NCS 540    | IOS XR 7.9.1      |
| P3    |  NCS 540    | IOS XR 7.9.1      |
| PE4   |  NCS 540    | IOS XR 7.9.1      |
| CE1   |  IR 8340    | IOS XE 17.12.1    |
| CE2   |  ASR 1002   | IOS XE 17.9.3a    |

To establish connectivity between the WAN substation and the control center, the CE IR8340 is deployed as a substation router connected to an RTU (Remote Terminal Unit), while the CE ASR-1002 headend router is connected to the control center. We will establish an L3VPN SCADA service between the endpoints.


## Configuration

We will start with configuring static Circuit-Style Segment Routing (CS-SR) policy, manual (persistent) adjacency SIDs need to be defined under the IGP interfaces. These adjacency SIDs will then constitute the explicit segment lists for the working and protect paths.

<div class="highlighter-rouge">
<pre class="highlight">
<code>
router isis 1008
 ...
 address-family ipv4 unicast
 ...
 interface TenGigE0/0/0/15
  ...
   <mark>adjacency-sid absolute 15016</mark>
  !
 !
</code>
</pre>
</div>

When configuring a static Circuit-Style Segment Routing (CS-SR) policy, the first step involves defining the segment lists for each of the working and protect paths in both forward and backward directions. In the next snippets, we will demonstrate the configuration for the working path at node PE1, while a similar process would be followed for the protect path.

<div class="highlighter-rouge">
<pre class="highlight">
<code>
segment-routing
 global-block 16000 23999
 traffic-eng
  segment-list <mark>cs-working-bck</mark>
   index 1 mpls label 15025
   index 2 mpls label 15016
  !
  segment-list <mark>cs-working-fwd</mark>
   index 1 mpls label 15016
   index 2 mpls label 15025
  !
 !
</code>
</pre>
</div>

So, we proceed to define the SR policy at PE1. The color attribute is assigned to the policy end-point IP i.e. loopback IP of PE2. path-protection command enables end-to-end candidate path protection.

Next, the candidate-paths, namely the working path & the protect path are configured. The working path is assigned a higher preference to establish it as the active path, while the protect path serves as the backup path, ready to take over in the event of failures.

One might wonder, “Why set up the reverse path at PE1 if the forward path is already defined at PE2?” However, the reverse-path config holds significance here in the context of SR-PM (Segment-Routing Performance-Measurement) liveness probes, that are needed to trigger path protection. By configuring the reverse-path, we ensure that the PM probes packets carry the labels in both the forward and reverse direction, thereby guaranteeing a robust path protection mechanism. 

We also set up a lock duration 


## Verification
